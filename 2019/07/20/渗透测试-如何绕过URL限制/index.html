
<main class="main" role="main">
  <div class="content">
  <article id="post-渗透测试-如何绕过URL限制" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      如何绕过URL限制
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2019/07/20/渗透测试-如何绕过URL限制/" class="article-date">
	  <time datetime="2019-07-20T04:25:40.000Z" itemprop="datePublished">2019-07-20</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/WEB安全/">WEB安全</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link" href="/tags/WEB渗透测试/">WEB渗透测试</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2019/07/20/渗透测试-如何绕过URL限制/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 2.2k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 8(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="1、如何绕过URL限制"><a href="#1、如何绕过URL限制" class="headerlink" title="1、如何绕过URL限制"></a>1、如何绕过URL限制</h1><h2 id="1-1、描述："><a href="#1-1、描述：" class="headerlink" title="1.1、描述："></a>1.1、描述：</h2><ul>
<li><font face="微软雅黑">URL重定向漏洞（URL redirection vulnerability），是一种常见的Web安全漏洞，由于网站URL重定向功能设计不当，没有验证跳转的目标URL是否合法，用户可通过此漏洞跳转到任意网站，这会导致可通过该网站跳转到存在木马、病毒的网站或者钓鱼网站，损害网站用户权利、网站名誉。</font></li>
</ul>
<h2 id="1-2、正常思路："><a href="#1-2、正常思路：" class="headerlink" title="1.2、正常思路："></a>1.2、正常思路：</h2><ul>
<li><font face="微软雅黑">就是直接替换后面的URL来检测是否存在任意URL跳转，如果不存在，就直接返回到它自己的域名，如果存在，就跳转到你指定的URL</font></li>
</ul>
<h2 id="1-3、payload："><a href="#1-3、payload：" class="headerlink" title="1.3、payload："></a>1.3、payload：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- ///www.baidu.com/%2f%2e%2e</span><br><span class="line">- /https://%5cbaidu.com/</span><br><span class="line">- //www.baidu.com</span><br><span class="line">- /www.baidu.com</span><br><span class="line">- https://www.google.com/www.baidu.com</span><br><span class="line">- /%2Fbaidu%252Ecom</span><br><span class="line">- http://www.google.com\.baidu.com</span><br><span class="line">- http://www.google.com\@baidu.com</span><br><span class="line">- http://www.google.com\#baidu.com</span><br><span class="line">- http://www.google.com\?baidu.com</span><br><span class="line">- http://www.google.com\\baidu.com</span><br><span class="line">- http://www.google.com\baidu.com:</span><br></pre></td></tr></table></figure>

<h2 id="1-4、Bypass"><a href="#1-4、Bypass" class="headerlink" title="1.4、Bypass"></a>1.4、Bypass</h2><h3 id="0x01-利用问号绕过限制"><a href="#0x01-利用问号绕过限制" class="headerlink" title="0x01 利用问号绕过限制"></a>0x01 利用问号绕过限制</h3><ul>
<li><font face="微软雅黑">利用问号，这是一个特性，利用问号可以成功绕过URL限制<br>比如：<a href="http://www.aaa.com/acb?Url=http://login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://login.aaa.com</a> 这是一个跳转链接，跳转到它的二级域名下，那么这个问号放哪里可以绕过呢？其实就是放到它自身的域名前面也就是你添加的想要跳转的域名的后面，如：<a href="http://www.aaa.com/acb?Url=http://test.com?login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.com?login.aaa.com</a> 那么，它其实是会跳转到这个test.com域名下，这个域名是我想要跳转的任意域名，而后面的它自身域名一定要带上，不带上就无法辅助用问号?这个特性来跳转到指定域名了，而跳转后，问号和问号后面的内容会变为这样：<a href="http://www.test.com/?login.aaa.com" target="_blank" rel="noopener">http://www.test.com/?login.aaa.com</a></font></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：http://www.test.com/abc？url=http//payload.com?test1.com</span><br></pre></td></tr></table></figure>

<h3 id="0x02-利用反斜杠和正斜杠绕过限制"><a href="#0x02-利用反斜杠和正斜杠绕过限制" class="headerlink" title="0x02 利用反斜杠和正斜杠绕过限制"></a>0x02 利用反斜杠和正斜杠绕过限制</h3><ul>
<li><font face="微软雅黑">比如：<a href="http://www.aaa.com/acb?Url=http://login.aaa.com/" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://login.aaa.com/</a> 同样是在它本身域名前加上正斜杠，然后正斜杠前面跟上你想跳转的域名地址。<br>如：<a href="http://www.aaa.com/acb?Url=http://test.com/login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.com/login.aaa.com</a><br>反斜杠有三种思路<br>两个反斜杠绕过方法<br>比如：<a href="http://www.aaa.com/acb?Url=http://login.aaa.com/" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://login.aaa.com/</a> 同样是在它本身域名前加上两个反斜杠，然后两个反斜杠前面跟上你想跳转的域名地址。<br>如：<a href="http://www.aaa.com/acb?Url=http://test.com\login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.com\login.aaa.com</a><br>一个反斜杠绕过方法<br>如：<a href="http://www.aaa.com/acb?Url=http://test.comlogin.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.comlogin.aaa.com</a><br>另一种思路，一个反斜杠一个点<br>利用.这样的格式，也就是一个反斜杠加一个点来跳过限制，<br>如：<a href="http://www.aaa.com/acb?Url=http://test.com.login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.com.login.aaa.com</a></font></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：/ \  .</span><br></pre></td></tr></table></figure>

<h3 id="0x03-利用-绕过URL限制"><a href="#0x03-利用-绕过URL限制" class="headerlink" title="0x03 利用@绕过URL限制"></a>0x03 利用@绕过URL限制</h3><ul>
<li><font face="微软雅黑">如果你用这方法在火狐里进行跳转，会有弹窗提示，在其它游览器则没有。<br>如：&lt;a href=”<a href="http://www.aaa.com/acb?Url=http://login.aaa.com@test.com“”&gt;http://www.aaa.com/acb?Url=http://login.aaa.com@test.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://login.aaa.com@test.com“”&gt;http://www.aaa.com/acb?Url=http://login.aaa.com@test.com</a> 后面的test.com就是要跳转到的域名，前面的域名都是用来辅助以绕过限制的。</font></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：@</span><br></pre></td></tr></table></figure>

<h3 id="0x04-利用白名单缺陷绕过限制"><a href="#0x04-利用白名单缺陷绕过限制" class="headerlink" title="0x04 利用白名单缺陷绕过限制"></a>0x04 利用白名单缺陷绕过限制</h3><ul>
<li><font face="微软雅黑">有的域名白名单限制是不全的，比如如果想利用一个跳转，而这个跳转是通用，在这个公司网站很多子域名等都可以跳转，那么你买个域名也不算贵对吧。<br>为什么这么说呢，这个问题就是白名单限制不当，比如，当跳转的域名包含这个网站下的所有域名，比如：<a href="http://www.aaa.com/acb?Url=http://login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://login.aaa.com</a><br>这个login.aaa.com也可以改成aaa.com同样可以跳转对吧，因为白名单里只要有包含这个域名就直接成功跳转。<br>那么当我在这个域名前面加上如testaaa.com，白名单里会检查是否包含aaa.com这个域名，如果包含，就直接跳转，而并没有检查这个域名的整个信息，然后可以利用这个问题，直接注册一个testaaa.com这个域名就可以利用这个跳转。</font></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Payload:testaaa.com</span><br></pre></td></tr></table></figure>

<h3 id="0x05-多重验证-amp-跳转绕过限制"><a href="#0x05-多重验证-amp-跳转绕过限制" class="headerlink" title="0x05 多重验证&amp;跳转绕过限制"></a>0x05 多重验证&amp;跳转绕过限制</h3><ul>
<li><font face="微软雅黑">现在很多网站都有多重验证，比如你登陆账户后会出现另一个验证页面，输入手机验证码进行验证，此时这上面的URL很可能存在任意跳转的问题。<br>多重跳转的问题导致可绕过URL限制<br>比如<a href="http://www.aaa.com/acb?Url=http" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http</a>: … ttp://login.aaa.com<br>当然，还有多重的，这个结构的多重跳转你修改最后面的URL就可以达到任意URL跳转，中间的URL就没必要动了。</font></li>
</ul>
<h3 id="0x06-点击触发达到绕过URL跳转限制"><a href="#0x06-点击触发达到绕过URL跳转限制" class="headerlink" title="0x06 点击触发达到绕过URL跳转限制"></a>0x06 点击触发达到绕过URL跳转限制</h3><ul>
<li><font face="微软雅黑">比如很多登陆页面的地方，其URL是一个跳转的URL<br>如：<a href="http://www.aaa.com/acb?Url=http://test.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.com</a><br>你直接修改了后面为任意URL，但是还是停留在原地，似乎没什么问题，但是，当你输入账号和密码后点击登陆按钮后，就会触发跳转。<br>当然，这个账户和密码不一定要对的，随便都可以，但得视系统而定吧。<br>这个我遇到了很多，比如你修改了域名，然后点击登陆，登陆成功后便可触发跳转，这也是一个比较隐蔽的绕过URL限制的跳转。</font></li>
</ul>
<h3 id="0x07-利用xip-io绕过"><a href="#0x07-利用xip-io绕过" class="headerlink" title="0x07 利用xip.io绕过"></a>0x07 利用xip.io绕过</h3><ul>
<li><font face="微软雅黑">这个我还没有在测试中应用过，其请求是<a href="http://www.127.0.0.1.xip.io" target="_blank" rel="noopener">http://www.127.0.0.1.xip.io</a> 这个绕过是在SSRF场景中的绕过，比如SSRF你要读取内网地址，一般都做了限制，可以尝试用这方法进行绕过限制，从而访问到内网。<br>另外一点，URL跳转涉及的安全问题大家常见的就是钓鱼，那么利用这个思路也可达成一个钓鱼问题，如，<a href="http://www.qq.com.127.0.0.1.xip.io" target="_blank" rel="noopener">http://www.qq.com.127.0.0.1.xip.io</a><br>当你访问qq这个域名时，其实这个链接已经被解析到后面这个ip地址上了，那么实际访问的就是后面这个IP地址。</font></li>
</ul>
<p><font face="微软雅黑"><center><img src="https://ae01.alicdn.com/kf/H859abc96cb734526bc817af79bb78c37X.png" style="zoom:30%"></center></font></p>
<h3 id="0x08-利用超链接绕过可信站点限制"><a href="#0x08-利用超链接绕过可信站点限制" class="headerlink" title="0x08 利用超链接绕过可信站点限制"></a>0x08 利用超链接绕过可信站点限制</h3><ul>
<li><font face="微软雅黑">比如一个URL，它是可以直接跳转的，但是一般测试跳转时大家习惯用<a href="http://www.baidu.com或qq.com这样的可信站点进行测试，但是有些网站是可以跳转这些网站的。" target="_blank" rel="noopener">www.baidu.com或qq.com这样的可信站点进行测试，但是有些网站是可以跳转这些网站的。</a><br>只要是可信站点且常用，基本都可以跳转，那么这就属于正常的业务逻辑了，难度/Users/vk/Documents/Secure/Blog/content/post/代码审计-任意文件读取.md就这样错失一个URL跳转漏洞了？<br>其实不然，只要你的URL被百度收录过，那么直接搜索你的域名，site:xxx.xxx<br>因为你在百度里点击你的域名，它会先是一个302跳转，而这个302跳转就是百度下的302跳转，那么这样就可以绕过可信站点的限制，从而达到跳转到指定URL。<br>当然，百度这个302有点长，你给它进行加密就行。</font></li>
</ul>
<h3 id="0x09-POST参数中的URL跳转"><a href="#0x09-POST参数中的URL跳转" class="headerlink" title="0x09 POST参数中的URL跳转"></a>0x09 POST参数中的URL跳转</h3><ul>
<li><font face="微软雅黑">当然，这个影响就很小了，比如当你填什么表格或者需要填写什么的，当你上传图片，点击下一步的时候，通常下一步就是预览你填写的信息，最后才是提交。<br>当你上传了图片后点击下一步抓包，如果过滤不严，你会看到图片的完整地址包含在POST参数里，你就可以直接修改这个地址为任意URL，然后到达下一步。<br>这时是确定信息也就是预览自己填写的信息的正确还是不正确，由于你刚刚修改了图片地址，这里是没有显示出来的，图像会是一个小XX。<br>当点击图片右键选择查看图像时，就会触发URL跳转问题，其实这个也可以利用来进行钓鱼，钓后台审核员的信息。<br>为什么呢，比如审核看到图片无法加载，一般都会点击查看图片，然后跳转，如果安全意识不知就会造成安全影响。<br>当然，如果POST参数里就只是URL跳转参数，那么你可以给它转成GET方式，然后进行跳转就可以了，只要网站支持这样的GET方式就行。<br>在Burp Suite里可以一键转换提交方式，右键选择Change request method就可以！</font></li>
</ul>
<h3 id="0x10-利用-号绕过"><a href="#0x10-利用-号绕过" class="headerlink" title="0x10 利用#号绕过"></a>0x10 利用#号绕过</h3><ul>
<li><font face="微软雅黑">如：<a href="http://www.aaa.com/acb?Url=http://test.com#login.aaa.com" target="_blank" rel="noopener">http://www.aaa.com/acb?Url=http://test.com#login.aaa.com</a></font></li>
</ul>
<h3 id="0x09-FUZZ"><a href="#0x09-FUZZ" class="headerlink" title="0x09 FUZZ"></a>0x09 FUZZ</h3><ul>
<li><font face="微软雅黑">重定向Payloads by @cujanovic<br><a href="https://github.com/cujanovic/Open-Redirect-Payloads" target="_blank" rel="noopener">https://github.com/cujanovic/Open-Redirect-Payloads</a></font></li>
<li><font face="微软雅黑">重定向参数 by @fuzzdb-project<br><a href="https://github.com/fuzzdb-project/fuzzdb/blob/master/attack/redirect/redirect-urls-template.txt" target="_blank" rel="noopener">https://github.com/fuzzdb-project/fuzzdb/blob/master/attack/redirect/redirect-urls-template.txt</a></font></li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://vkxss.top/2019/07/20/渗透测试-如何绕过URL限制/" title="如何绕过URL限制" target="_blank" rel="external">http://vkxss.top/2019/07/20/渗透测试-如何绕过URL限制/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">VK</span><small class="ml-1x">VK&#39;Blog</small></a></h3>
        <div>ddddhm</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2019/08/19/代码审计-任意文件读取/" title="任意文件读取"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2019/07/19/渗透测试-SSRF绕过的方法/" title="SSRF绕过的方法"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>
